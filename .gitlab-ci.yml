#
# Generated by: hguild source:run Catalyst gitlabCIBuildYML
#

variables:
    HGUILD_PROJECT_NAME: libWexpr
    HGUILD: _HGuild/Source/HGuild@master/Prefix/hguild
    HGUILD_GIT_USE_HTTPS: 1

before_script:
    # Note: this is here instead of varaibles cause gitlab expands it oddly otherwise
    - export GIT_SSL_CAINFO="$CI_SERVER_TLS_CA_FILE"
    - git config --global credential.helper '!f() { sleep 1; echo "username=gitlab-ci-token\npassword=${CI_JOB_TOKEN}"; }; f'
    - curl -fsSL 'http://developer.hackerguild/HGuildCI/hguildCISetup.rb' | ruby -- -
    - ${HGUILD} packages:update

stages:
    - prepare
    - build
    - package


Linux-X86_64@Clang@@~Debug:Prepare:
    cache:
        key: "Linux-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - ninja
        - linux
        - clang
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

Linux-X86_64@Clang@@~Debug:Build:
    cache:
        key: "Linux-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - ninja
        - linux
        - clang
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI

Linux-X86_64@Clang@@~Debug:Package:
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    cache:
        key: "Linux-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - ninja
        - linux
        - clang
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'http://developer.hackerguild/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg


Linux-X86_64@Clang@@~Release:Prepare:
    cache:
        key: "Linux-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - ninja
        - linux
        - clang
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

Linux-X86_64@Clang@@~Release:Build:
    cache:
        key: "Linux-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - ninja
        - linux
        - clang
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI

Linux-X86_64@Clang@@~Release:Package:
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    cache:
        key: "Linux-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - ninja
        - linux
        - clang
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'http://developer.hackerguild/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg


macOS-X86_64@Clang@@~Debug:Prepare:
    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

macOS-X86_64@Clang@@~Debug:Build:
    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI

macOS-X86_64@Clang@@~Debug:Package:
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'http://developer.hackerguild/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg


macOS-X86_64@Clang@@~Release:Prepare:
    cache:
        key: "macOS-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

macOS-X86_64@Clang@@~Release:Build:
    cache:
        key: "macOS-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release
        
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI

macOS-X86_64@Clang@@~Release:Package:
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    cache:
        key: "macOS-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'http://developer.hackerguild/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg

