#
# Generated by: hguild source:run Catalyst gitlabCIBuildYML
#

variables:
    HGUILD_PROJECT_NAME: libWexpr
    HGUILD: _HGuild/Source/HGuild@master/Prefix/hguild
    HGUILD_GIT_USE_HTTPS: 1

before_script:
    - git config --global credential.helper '!f() { sleep 1; echo "username=gitlab-ci-token"; echo "password=${CI_JOB_TOKEN}"; }; f'
    - echo "CI JOB TOKEN: ${CI_JOB_TOKEN}"
    - curl -fsSL 'https://developer.i.hackerguild.com/HGuildCI/hguildCISetup.rb' | ruby -- -
    - ${HGUILD} packages:update

stages:
    - prepare
    - build
    - test
    - package


Linux-X86_64@Clang@@~Debug:Prepare:
    image: docker.i.hackerguild.com/hackerguild/hackerguild-gitlabci-docker:latest

    except:
      - schedules

    cache:
        key: "Linux-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - linux
        - docker
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
    
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

Linux-X86_64@Clang@@~Debug:Build:
    image: docker.i.hackerguild.com/hackerguild/hackerguild-gitlabci-docker:latest

    except:
      - schedules

    cache:
        key: "Linux-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - linux
        - docker
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug

    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI



Linux-X86_64@Clang@@~Debug:Package:
    image: docker.i.hackerguild.com/hackerguild/hackerguild-gitlabci-docker:latest
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    except:
      - schedules

    cache:
        key: "Linux-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - linux
        - docker
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'https://developer.i.hackerguild.com/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg


Linux-X86_64@Clang@@~Release:Prepare:
    image: docker.i.hackerguild.com/hackerguild/hackerguild-gitlabci-docker:latest

    except:
      - schedules

    cache:
        key: "Linux-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - linux
        - docker
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release
    
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

Linux-X86_64@Clang@@~Release:Build:
    image: docker.i.hackerguild.com/hackerguild/hackerguild-gitlabci-docker:latest

    except:
      - schedules

    cache:
        key: "Linux-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - linux
        - docker
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release

    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI



Linux-X86_64@Clang@@~Release:Package:
    image: docker.i.hackerguild.com/hackerguild/hackerguild-gitlabci-docker:latest
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    except:
      - schedules

    cache:
        key: "Linux-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - linux
        - docker
        
    variables:
        HGUILD_PROFILE: Linux-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'https://developer.i.hackerguild.com/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg


macOS-X86_64@Clang@@~Debug:Prepare:

    except:
      - schedules

    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
    
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

macOS-X86_64@Clang@@~Debug:Build:

    except:
      - schedules

    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug

    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI



macOS-X86_64@Clang@@~Debug:Package:
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    except:
      - schedules

    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'https://developer.i.hackerguild.com/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg


macOS-X86_64@Clang@@~Release:Prepare:

    except:
      - schedules

    cache:
        key: "macOS-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: prepare
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release
    
    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . --dependenciesOnly ${HGUILD_PROJECT_NAME}@CI

macOS-X86_64@Clang@@~Release:Build:

    except:
      - schedules

    cache:
        key: "macOS-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: build
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release

    script:
        - ${HGUILD} install --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI



macOS-X86_64@Clang@@~Release:Package:
    only:
        - tags   # tags are stable
        - master # master branch we always want the newest ref
        # TODO? release branches. But we dont want to pickup issue branches.

    except:
      - schedules

    cache:
        key: "macOS-X86_64@Clang@@~Release"
        paths:
        - _HGuild/
        
    stage: package
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Release

    script:
        - ${HGUILD} source:install:package --buildType "${HGUILD_BUILDTYPE}" --profile "${HGUILD_PROFILE}" --customSourceDir . ${HGUILD_PROJECT_NAME}@CI build.hguildpkg
        - curl -fsSL 'https://developer.i.hackerguild.com/HGuildCI/hguildCIUpload.rb' | ruby -- - "${HGUILD_PROJECT_NAME}" "${CI_COMMIT_REF_NAME}" "${HGUILD_PROFILE}" "${HGUILD_BUILDTYPE}" build.hguildpkg
        - rm build.hguildpkg

Scheduler:
    only:
      - schedules
      
    cache:
        key: "macOS-X86_64@Clang@@~Debug"
        paths:
        - _HGuild/

    stage: build
    tags:
        - ninja
        - osx
        - clang
        
    variables:
        HGUILD_PROFILE: macOS-X86_64@Clang@@
        HGUILD_BUILDTYPE: Debug
        HGUILD_SOURCENAME: libWexpr@CI

    script:
      - Support/gitlabScheduler.rb

